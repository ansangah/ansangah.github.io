{{ $page := .page }}
{{ $index := .index | default 0 }}
{{ $featured := partial "functions/get_featured_image.html" $page }}
{{ $dlKindLabels := dict
  "textbook" (i18n "ai_blog_dl_kind_textbook" | default "Deep Learning Textbook")
  "notes" (i18n "ai_blog_dl_kind_notes" | default "Deep Learning Notes & Papers")
  "subjectsCount" (i18n "ai_blog_dl_kind_subjects" | default "Subject Guides")
}}
{{ $dlKindKey := "" }}
{{ $dlKind := i18n "ai_blog_dl_kind_default" | default "AI Study" }}
{{ with $page.Params.dl_kind }}
  {{ $dlKindKey = . }}
  {{ with index $dlKindLabels $dlKindKey }}
    {{ $dlKind = . }}
  {{ else }}
    {{ $dlKind = $dlKindKey }}
  {{ end }}
{{ end }}

<article class="group flex h-full flex-col overflow-hidden rounded-3xl border border-gray-200 bg-slate-100 shadow-sm ring-1 ring-black/5 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl dark:border-gray-700 dark:bg-[#1f2a44] dark:ring-white/10">
  <a href="{{ $page.RelPermalink }}" class="flex h-full flex-col focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500">
    <div class="relative aspect-[16/9] overflow-hidden bg-gradient-to-br from-slate-200 via-slate-100 to-slate-300 dark:from-slate-800 dark:via-slate-700 dark:to-slate-800">
      {{ $imgResource := $featured }}
      {{ if and (not $imgResource) $page.Params.image.filename }}
        {{ $imgResource = $page.Resources.GetMatch $page.Params.image.filename }}
      {{ end }}
      {{ if $imgResource }}
        {{ $img := $imgResource.Fill "800x450 Center" }}
        <img
          src="{{ $img.RelPermalink }}"
          width="{{ $img.Width }}"
          height="{{ $img.Height }}"
          loading="lazy"
          decoding="async"
          alt="{{ $page.Title | plainify }} featured image"
          class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
        >
      {{ else if and (eq $dlKindKey "subjectsCount") $page.Params.image.filename }}
        {{ $imgURL := printf "%s%s" $page.RelPermalink $page.Params.image.filename }}
        <img
          src="{{ $imgURL | relURL }}"
          loading="lazy"
          decoding="async"
          alt="{{ $page.Title | plainify }} featured image"
          class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
        >
      {{ else if eq $dlKindKey "subjectsCount" }}
        <div class="flex h-full w-full items-center justify-center text-4xl text-slate-400 dark:text-slate-200">
          <span>ðŸ“š</span>
        </div>
      {{ else }}
        <div class="flex h-full w-full items-center justify-center text-4xl text-slate-400">
          <span>ðŸ¤–</span>
        </div>
      {{ end }}
    </div>

    <div class="flex flex-1 flex-col gap-4 p-6">
      <div class="flex items-center justify-between text-[11px] font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-300">
        <span>{{ $dlKind }}</span>
        <time datetime="{{ $page.Date.Format "2006-01-02" }}" class="tracking-normal text-slate-400 dark:text-slate-200">{{ $page.Date.Format "2006-01-02" }}</time>
      </div>

      <h3 id="ai-card-title-{{ $page.File.UniqueID }}" class="ai-card-title text-xl font-semibold leading-snug text-slate-900 transition-colors duration-300 group-hover:text-blue-600 dark:text-white dark:group-hover:text-blue-300">
        {{ $page.LinkTitle | default ($page.Title | plainify) }}
      </h3>

      {{ with $page.Summary }}
        <p class="text-sm leading-6 text-slate-600 line-clamp-4 dark:text-slate-200 text-justify">
          {{ . }}
        </p>
      {{ end }}

      {{ with $page.Params.course_topics }}
        <ul class="mt-auto flex flex-wrap gap-2">
          {{ range first 4 . }}
            <li class="rounded-full bg-slate-200 px-3 py-1 text-xs font-medium text-slate-600 dark:bg-[#283a57] dark:text-slate-100">{{ . }}</li>
          {{ end }}
          {{ if gt (len .) 4 }}
            <li class="rounded-full bg-slate-200 px-3 py-1 text-xs font-medium text-slate-600 dark:bg-[#283a57] dark:text-slate-100">+{{ sub (len .) 4 }}</li>
          {{ end }}
        </ul>
      {{ end }}
    </div>
  </a>
</article>

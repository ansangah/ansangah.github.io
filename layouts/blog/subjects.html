{{ define "main" }}
<main class="container mx-auto px-4 py-8">
  <header class="mb-10 text-center">
    {{ $defaultTagline := cond (eq .Site.Language.Lang "ko") "COURSE STUDY HUB" "COURSE STUDY HUB" }}
    {{ $tagline := .Params.tagline | default $defaultTagline }}
    {{ if $tagline }}
      <p class="hb-tagline">{{ $tagline }}</p>
    {{ end }}
    <h1 class="hb-tag-title text-3xl font-extrabold tracking-tight text-gray-900 dark:text-white">{{ .Title }}</h1>
    {{ with .Content }}<div class="prose text-justify mt-4 mx-auto text-left max-w-2xl">{{ . }}</div>{{ end }}
  </header>

  {{ $pages := .RegularPages }}
  {{ $order := slice "3-2" "3-1" "2-2" "2-1" }}
  {{ $labels := dict
    "3-2" (i18n "subjects_semester_3_2" | default "Year 3 路 Semester 2")
    "3-1" (i18n "subjects_semester_3_1" | default "Year 3 路 Semester 1")
    "2-2" (i18n "subjects_semester_2_2" | default "Year 2 路 Semester 2")
    "2-1" (i18n "subjects_semester_2_1" | default "Year 2 路 Semester 1")
  }}

  {{ range $order }}
    {{ $semester := . }}
    {{ $semesterPages := where $pages "Params.semester" $semester }}
    {{ if gt (len $semesterPages) 0 }}
      <section class="mb-12">
        {{ with index $labels $semester }}
          <h2 class="mb-5 text-2xl font-semibold text-gray-900 dark:text-white">{{ . }}</h2>
        {{ end }}
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {{ range $semesterPages.ByDate.Reverse }}
            <article class="rounded-2xl border border-gray-200 dark:border-gray-700 bg-slate-100 dark:bg-[#1f2a44] shadow-sm transition-all hover:-translate-y-1 hover:shadow-lg">
              <a class="block h-full p-5" href="{{ .RelPermalink }}">
                <div class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-slate-200">
                  {{ .Date.Format "2006-01-02" }}
                </div>
                <h3 class="mt-2 text-lg font-semibold text-gray-900 dark:text-white">
                  {{ .Title }}
                </h3>
                {{ with .Summary }}
                  <p class="mt-2 text-sm leading-6 text-slate-600 dark:text-slate-100 text-justify">
                    {{ . }}
                  </p>
                {{ end }}
                {{ with .Params.course_topics }}
                  <ul class="mt-4 flex flex-wrap gap-2">
                    {{ range . }}
                      <li class="rounded-full bg-slate-200 dark:bg-[#283a57] px-3 py-1 text-xs font-medium text-slate-600 dark:text-slate-100">
                        {{ . }}
                      </li>
                    {{ end }}
                  </ul>
                {{ end }}
              </a>
            </article>
          {{ end }}
        </div>
      </section>
    {{ end }}
  {{ end }}

  {{ $catchall := where $pages "Params.semester" "==" nil }}
  {{ $unordered := where $pages "Params.semester" "not in" $order }}
  {{ $others := union $catchall $unordered }}
  {{ if gt (len $others) 0 }}
    <section class="mb-12">
      <h2 class="mb-5 text-2xl font-semibold text-gray-900 dark:text-white">{{ i18n "subjects_unassigned_heading" | default "Unassigned Semester" }}</h2>
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {{ range $others.ByDate.Reverse }}
          <article class="rounded-2xl border border-gray-200 dark:border-gray-700 bg-slate-100 dark:bg-[#1f2a44] shadow-sm transition-all hover:-translate-y-1 hover:shadow-lg">
            <a class="block h-full p-5" href="{{ .RelPermalink }}">
              <div class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-slate-200">
                {{ .Date.Format "2006-01-02" }}
              </div>
              <h3 class="mt-2 text-lg font-semibold text-gray-900 dark:text-white">
                {{ .Title }}
              </h3>
              {{ with .Summary }}
                <p class="mt-2 text-sm leading-6 text-slate-600 dark:text-slate-100 text-justify">
                  {{ . }}
                </p>
              {{ end }}
            </a>
          </article>
        {{ end }}
      </div>
    </section>
  {{ end }}
</main>
{{ end }}

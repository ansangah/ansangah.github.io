{{ define "main" }}
<main class="container mx-auto px-4 py-8 course-archive">
  <header class="mb-10 text-center">
    <h1 class="text-3xl font-extrabold tracking-tight text-gray-900 dark:text-white">{{ .Title }}</h1>
    {{ with .Content }}<div class="prose mt-4 mx-auto text-left max-w-2xl">{{ . }}</div>{{ end }}
  </header>

  {{ $pages := .RegularPages }}
  {{ $order := slice "3-2" "3-1" "2-2" "2-1" }}
  {{ $labels := dict "3-2" "3학년 2학기" "3-1" "3학년 1학기" "2-2" "2학년 2학기" "2-1" "2학년 1학기" }}

  {{ range $order }}
    {{ $semester := . }}
    {{ $semesterPages := where $pages "Params.semester" $semester }}
    {{ if gt (len $semesterPages) 0 }}
      <section class="course-semester mb-14">
        <div class="course-semester__heading">
        <span class="course-semester__badge">{{ $semester }}</span>
        {{ with index $labels $semester }}
          <span class="course-semester__label text-slate-600 dark:text-white/80">{{ . }}</span>
        {{ end }}
      </div>
      <div class="course-semester__grid">
        {{ range $semesterPages.ByDate.Reverse }}
          <article class="course-card group border border-slate-200/80 dark:border-slate-700/70 bg-slate-50 dark:bg-slate-900/60 px-6 py-5 sm:px-7 sm:py-6 shadow-sm hover:border-indigo-400/60 dark:hover:border-indigo-300/60 transition-all">
            <div class="flex items-center text-[0.7rem] font-semibold uppercase tracking-[0.32em] text-slate-500 dark:text-slate-200">
              <span class="course-card__date">{{ .Date.Format "2006-01-02" }}</span>
            </div>
            <h3 class="mt-3 text-lg font-semibold text-slate-900 dark:text-white">
              <a href="{{ .RelPermalink }}" class="transition-colors hover:text-indigo-500 dark:hover:text-indigo-200">{{ .Title }}</a>
            </h3>
            {{ with .Summary }}
              <p class="mt-2 text-sm leading-6 text-slate-600 dark:text-slate-200">{{ . }}</p>
            {{ end }}
            {{ with .Params.course_topics }}
              <ul class="mt-4 flex flex-wrap gap-2">
                {{ range . }}
                  <li class="rounded-full bg-slate-200/70 dark:bg-slate-800 px-3 py-1 text-xs font-medium text-slate-600 dark:text-slate-200">{{ . }}</li>
                {{ end }}
              </ul>
            {{ end }}
          </article>
          {{ end }}
        </div>
      </section>
    {{ end }}
  {{ end }}

  {{ $catchall := where $pages "Params.semester" "==" nil }}
  {{ $unordered := where $pages "Params.semester" "not in" $order }}
  {{ $others := union $catchall $unordered }}
  {{ if gt (len $others) 0 }}
    <section class="course-semester mb-14">
      <div class="course-semester__heading">
        <span class="course-semester__badge">기타</span>
        <span class="course-semester__label text-slate-600 dark:text-white/80">학기 미분류</span>
      </div>
      <div class="course-semester__grid">
        {{ range $others.ByDate.Reverse }}
          <article class="course-card group border border-slate-200/80 dark:border-slate-700/70 bg-slate-50 dark:bg-slate-900/60 px-6 py-5 sm:px-7 sm:py-6 shadow-sm hover:border-indigo-400/60 dark:hover:border-indigo-300/60 transition-all">
            <div class="flex items-center gap-2 text-[0.7rem] font-semibold uppercase tracking-[0.32em] text-slate-500 dark:text-slate-200">
              {{ with .Params.semester }}
                <span class="inline-flex items-center rounded-full border border-indigo-200 dark:border-indigo-400/50 bg-indigo-50 dark:bg-indigo-500/20 px-3 py-1 text-[0.65rem] tracking-[0.3em] text-indigo-600 dark:text-indigo-100">{{ . }}</span>
              {{ end }}
              <span class="course-card__date">{{ .Date.Format "2006-01-02" }}</span>
            </div>
            <h3 class="mt-3 text-lg font-semibold text-slate-900 dark:text-white">
              <a href="{{ .RelPermalink }}" class="transition-colors hover:text-indigo-500 dark:hover:text-indigo-200">{{ .Title }}</a>
            </h3>
            {{ with .Summary }}
              <p class="mt-2 text-sm leading-6 text-slate-600 dark:text-slate-200">{{ . }}</p>
            {{ end }}
          </article>
        {{ end }}
      </div>
    </section>
  {{ end }}
</main>
{{ end }}
